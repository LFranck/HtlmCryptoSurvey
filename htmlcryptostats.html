<!DOCTYPE html>
<html lang="fr">
<head>
    <title>Found best parameters (Prototype)</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="manifest" href="site.webmanifest">
    <link rel="stylesheet" href="htmlcryptostats.css" type="text/css" media="screen"/>
    <script type="text/javascript" src="fonctions.js"></script>
    <script type="text/javascript">
        // Paramètres
        var currency, coin, limitPourcent, urlDay;
        var localDays = [], moyHigh = [], moyLow = [];
        var message = "";
        // Gestion interval
        var refreshUrlDay;
        // GetCours
        var jsonDays = [];

         /**
         *
         * @returns {undefined}
         */
        function printArrays() {
            //console.log("printArrays");
            var tripstart = document.getElementById("tripstart").value;
            var nbJoursMax = 10;
            var message = "";
            // Nombre de critères
            for (var nbcriteres = 1; nbcriteres < 4; nbcriteres++) {
                message += "<br /><table class='myOtherTable' width='10%'>";
                message += "<caption>Multiplication avec " + nbcriteres + " / 3 critères vérifiés (nombre d'opération).</caption>";
                message += "<tr><th>Limite\\Moy</th>";
                for (var nbjours = 2; nbjours < nbJoursMax + 1; nbjours++) {
                    message += "<th>" + nbjours + " jours</th>";
                }
                message += "</tr>";
                // Pourcentage limite
                var max = 0;
                var joursmax = 0;
                var pourcentmax = 0;
                for (var pourcent = 1; pourcent < 21; pourcent++) {
                    message += "<tr><th>" + (pourcent * 5) + "%</th>";
                    for (var nbjours = 2; nbjours < nbJoursMax + 1; nbjours++) {
                        var out = {};
                        var result = calcul(jsonDays, tripstart, nbcriteres, pourcent * 5, nbjours, out);
                        message += "<td style='text-align:right'>" + result + "</td>";
                        if (out.total >= max) {
                            pourcentmax = pourcent * 5;
                            joursmax = nbjours;
                            max = out.total;
                        }
                    }
                    message += "</tr>";
                }
                message += "</table><h4>Multiplicateur max = " + max + " ( " + nbcriteres + " critère(s) minimun, moyenne de " + joursmax + " jours , " + pourcentmax + "% minimum pour le mouvement)</h4>";
            }
            return message;
        }

        function getJson2(urlDay, jsonDays) {
            //console.log("getJson2 ->" + urlDay + " = " + jsonDays.length);
            if (jsonDays.length > 0) {
                clearInterval(refreshUrlDay);
                document.getElementById("statresult").innerHTML = printArrays();
                document.getElementById("statresult").style.visibility = "visible";
                document.getElementById("bg_mask").style.visibility = "hidden";
            } else {
                getJson(urlDay, jsonDays);
                refreshUrlDay = setInterval(function () {
                    //console.log("setInterval");
                    getJson2(urlDay, jsonDays);
                }, 5000);
            }
        }

        /**
         * Mets à jours les tableaux contenants les valeurs
         * @returns {undefined}
         */
        function toDo() {
            clearInterval(refreshUrlDay);
            coin = document.getElementById("sbitcoin").value;
            exchange = document.getElementById("exchange").value;
            currency = document.getElementById("scurrency").value;
            document.getElementById("statresult").style.visibility = "hidden";
            document.getElementById("bg_mask").style.visibility = "visible";
            // Annulation des elements précédent
            jsonDays = [];
            // Le cours des derniers jours
            urlDay = constructUrl("histoday", coin, currency, exchange, "allData=true");
            getJson2(urlDay, jsonDays);
        }

        window.onload = function () {
            toDo();
        }
    </script>
</head>
<body>
<table width="50%">
    <tr>
        <th align="left" colspan="4">Choix statistiques</th>
    </tr>
    <tr>
        <td>Exchange</td>
        <td>Crypto</td>
        <td>Currency</td>
        <td>Date de Départ</td>
    </tr>
    <tr>
        <td><select name="exchange" id="exchange" size="5" onChange="toDo();">
            <option value="Bitfinex">Bitfinex</option>
            <option value="Coinbase">Coinbase</option>
            <option value="HitBTC">HitBTC</option>
            <option value="Kraken" selected>Kraken</option>
        </select></td>
        <td><select id="sbitcoin" size="5" onChange="toDo();">
            <option value="ADA">ADA</option>
            <option value="AAVE">AAVE</option>
            <option value="ALGO">ALGO</option>
            <option value="BAT">BAT</option>
            <option value="BCH">Bitcoin Cash</option>
            <option value="BNB">BNB</option>
            <option value="BTC" selected>Bitcoin</option>
            <option value="DASH">Dash</option>
            <option value="DOT">DOT</option>
            <option value="ETC">ETC</option>
            <option value="ETH">Ethereum</option>
            <option value="EOS">EOS</option>
            <option value="ICX">ICX</option>
            <option value="LEND">LEND</option>
            <option value="LINK">Chain Link</option>
            <option value="LTC">LTC</option>
            <option value="QNT">QNT</option>
            <option value="RLC">RLC</option>
            <option value="SXP">SXP</option>
            <option value="TRB">TRB</option>
            <option value="TRX">TRX</option>
            <option value="USDC">USDC</option>
            <option value="USDT">Tehter USD</option>
            <option value="XLM">Lumen</option>
            <option value="XMR">Monero</option>
            <option value="XRP">Ripple</option>
            <option value="XTZ">XTZ</option>
        </select></td>
        <td><select id="scurrency" onChange="toDo();" size="5">
            <option value="USD">USD</option>
            <option value="EUR" selected>EUR</option>
        </select></td>
        <td><input type="date" id="tripstart" name="tripstart" value="2010-01-01" min="2010-01-01"
                                  max="2021-12-31" onchange="toDo();"></td>
    </tr>
</table>
<div id="bg_mask" style="background-position:50px 50px; height:0px; width:0px; visibility:visible"><img
        src="loading.gif"/></div>
<div id="statresult" style="visibility: hidden"></div>
<div id="source">2020©LFRANCK - Cours provenant de l'API cryptocompare.com - Version 0.3.21 30/11/2020</div>
</body>
</html>